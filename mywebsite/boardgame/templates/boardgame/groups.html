{% extends 'boardgame/base.html' %}
{% load static %}
{% block content %}
<title>Groups</title>
<head>
<h3>Groups</h3>
</head>
<div class="container">
    <!-- Row for search bar and buttons -->
    <div class="row">
        <!-- Left column for search bar, buttons, and filters -->
        <div class="col-md-3">
            <!-- Search bar -->
            <div class="mb-2">
                <form method="get" action="{% url 'groups' %}">
                    <div class="input-group">
                        <input type="text" class="form-control" id="search-bar" name="search" placeholder="Search groups" value="{{ request.GET.search }}">
                    </div>
                </form>
                <br/>
                <a href="{% url 'groups' %}" class="btn btn-primary btn-sm">Featured Groups</a>
            </div>
            <!-- Buttons for actions -->
            {% if user.is_authenticated %}
            <div class="mb-5">
                <a href="?your_groups=true" class="btn btn-primary btn-sm mb-2">Your Groups</a><br/>
                <a href="{% url 'create_group' %}" class="btn btn-primary btn-sm mb-2">Create Group</a>
            </div>
            {% endif %}
    
            <hr>
            <!-- Tags and Categories Filters -->
            <div class="mb-3">
                <h5>Browse Groups by Game Categories</h5>
                <div class="row">
                    {% if categories %}
                    {% for category in categories %}
                    <div class="col-6 mb-2">
                        <a href="?category={{ category.name }}" class="category-link">{{ category.name }}</a>
                    </div>
                    {% endfor %}
                    {% else %}
                    <p>No categories available</p>
                    {% endif %}
                </div>
            </div>
            <div class="mb-3">
                <h5>Browse Groups by Tags</h5>
                <div class="row">
                    {% if tags %}
                    {% for tag in tags %}
                    <div class="col-6 mb-2">
                        <a href="?tag={{ tag.name }}" class="tag-link">{{ tag.name }}</a>
                    </div>
                    {% endfor %}
                    {% else %}
                    <p>No tags available</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Right column for group cards -->
        <div class="col-md-9">
            <h3>
                {% if request.GET.your_groups %}
                    Your Groups
                {% elif request.GET.tag %}
                    Results for Tag: {{ request.GET.tag }}
                {% elif request.GET.category %}
                    Results for Category: {{ request.GET.category }}
                {% else %}
                    Featured Groups
                {% endif %}
            </h3>
          
            <div class="row" id="group-cards">
                {% if groups %}
                {% for group in groups %}
                <div class="col-md-4 mb-3">
                    <div class="card">
                        <div class="card-header">
                            <h4>{{ group.name }}</h4>
                        </div>
                        <div class="card-body">
                            <div class="group-profile">
                                {% if group.group_image %}
                                <img src="{{ group.group_image.url }}" class="profile-image rounded" style="width: 100%; height: auto;">
                                {% else %}
                                <img src="{% static 'boardgame/images/group_profile_default.jpg' %}" class="profile-image rounded" style="width: 100%; height: auto;">
                                {% endif %}
                                <br/><br/>
                                {{ group.group_members.all.count }} members
                                <p><b>Location:</b> {{ group.grouplocation.city }}{% if group.grouplocation.state %}, {{ group.grouplocation.state }}{% endif %}</p>
                                <a href="{% url 'group_profile' group.slug %}" class="btn btn-secondary btn-sm">View Group</a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
                {% else %}
                <strong>There are no groups present.</strong>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Link back to home -->
<div class="mt-3">
    <a href="{% url 'home' %}" class="btn btn-secondary btn-sm">Back to Home</a>
</div>

<style>
    .btn-group {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
    }

    .btn-group .btn {
        margin: 5px;
    }

    #group-cards {
        overflow-x: auto;
    }

    #group-cards .card {
        min-width: 300px;
    }

    /* Styling for tags and categories */
    .tag-link, .category-link {
        text-decoration: none;
        color: #4275af; /* Primary color for links */
        font-size: 0.9rem; /* Slightly smaller font size */
    }

    /* Ensure two items per row */
    .row > div {
        margin-bottom: 1rem;
    }
</style>

{% endblock %}
